!function(e){function t(){this.selectorText=null,this.style={},this.type="rule"}function n(){function e(e){var t=e.trim().split(";");return t.length?t.pop().trim():null}function n(e){var t={},n=e.trim().split(";");return!n||!n.length?t:(n.forEach(function(e){if(e.indexOf(":")==-1)return;var n,r,i=e.split(":");i[0]!==undefined&&i[1]!==undefined&&(n=i[0].trim(),r=i[1].trim().replace(/[\"\']/g,""),t[n]=r)}),t)}function r(i,s,o){function m(e,t){var n=0;while(t){switch(e.charAt(n)){case"{":t++;break;case"}":t--}n++}return n-1}var u=i.indexOf("{"),a,f=new t,l=i.substring(0,u),c=e(l),h=i.substr(u+1,i.length),p=h.indexOf("}"),d=h.indexOf("{");if(u>0){f.setSelector(c),o&&(f.setParentRule(o),a=n(l),o.setStyle(a));if(d>-1&&d<p){p=m(h,1);var v=h.substring(0,p);a=n(l),f.setStyle(a),f.cssRules=f.cssRules||[],r(v,f.cssRules,f),h=h.substring(p+1,h.length)}else a=n(h.substring(0,p)),f.setStyle(a),h=h.substring(p+1,i.length);r(h,s),s.unshift(f)}}function i(e){if(!e)throw new Error("CSSParser.cascadeRules(). No css rules available for cascade");if(!e.length)return e;var t=[],n={},r=[];return e.forEach(function(e){e.cssRules&&(e.cssRules=i(e.cssRules)),n[e.selectorText]?n[e.selectorText]=s({},n[e.selectorText],e):(r.push(e.selectorText),n[e.selectorText]=e)}),r.forEach(function(e){t.push(n[e])},this),n=null,r=null,t}function s(e){var t=Array.prototype.slice.call(arguments,1);return t.forEach(function(t){for(var n in t){if(n==="parentRule")return;typeof e[n]=="object"&&e[n]?typeof e[n].slice=="function"?e[n]=i(e[n].concat(t[n])):e[n]=s({},e[n],t[n]):e[n]=t[n]}}),e}return{cssRules:[],parse:function(e){e=e.replace(/[\n\t]+/g,"").replace(/\/\*[\s\S]*?\*\//g,"").trim(),r.call(this,e,this.cssRules)},parseCSSDeclaration:function(e){var t=[];return r.call(this,e,t),t.length&&t.length===1?t.pop():null},clear:function(){this.cssRules=[]},cascade:function(e){if(!e||!e.length){this.cssRules=i.call(this,this.cssRules);return}return i.call(this,e)},doExtend:s}}!function(){typeof String.prototype.trim!="function"&&(String.prototype.trim=function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")})}(),t.prototype={setSelector:function(e){this.selectorText=e;var t=e.match(/^@([^\s]+)\s*([^{]+)?/);if(t&&t[1]){switch(t[1]){case"template":this.type="template",this.cssRules=[];break;case"slot":this.type="slot";break;default:this.type="unknown"}this.identifier=t[2]||"auto"}},setStyle:function(e){if(!e)throw new TypeError("CSSRule.setStyles(). Invalid input. Expected 'object', got "+e);return this.style=e||{},this.style},setParentRule:function(e){if(!e)throw new TypeError("CSSRule.setParentRule(). Invalid input. Expected 'object', got "+properties);return this.parentRule=e,this.parentRule}},e=e||window,e.CSSParser=n}(window),window.CSSRegions=function(e){function t(){this.setup()}function v(){}function m(e,t){var n,r;if(typeof e.pop!="function")throw"Invalid input. Expected an array, got: "+typeof e;this.map={},this.length=0;for(n=0,r=e.length;n<r;n++)this[n]=e[n],this.length++,t&&e[n][t]&&(this.map[e[n][t]]=this[n])}function g(e,t,r){this.name=e||"none",this.overset=!0,this.contentNodes=[],this.regions=[],this.regionsByContent={},this._listeners={},this.firstEmptyRegionIndex=-1,t&&t.length&&(this.contentNodes=n(t)),r&&r.length&&(this.regions=n(r))}t.prototype={init:function(){var e,t,n,r,i,s=document.querySelector("style");this.setup();if(!document.styleSheets.length){console.log("No CSS rules defined!");return}if(s===null){console.log("There is no inline CSS for CSS Regions!");return}i=new CSSParser,i.parse(s.innerHTML);if(i.cssRules.length===0){console.log("There is no inline CSS for CSS Regions!");return}e=this.getNamedFlowRules(i.cssRules);for(t in e)n=e[t].contentNodesSelectors,r=e[t].regionsSelectors,this.namedFlows.push(new g(t,n,r));this.namedFlowCollection=new m(this.namedFlows,"name"),this.exposeGlobalOM(),this.doLayout()},setup:function(){this.namedFlows=[],this.namedFlowCollection=null},getNamedFlowRules:function(e){var t,n,r,i=e.length,s={};for(var o=0;o<i;o++){t=e[o];for(n in t.style)if(n.indexOf("flow-")!==-1){r=t.style[n],s[r]=s[r]||{contentNodesSelectors:[],regionsSelectors:[]},n.indexOf("flow-into")!==-1?s[r].contentNodesSelectors.push(t.selectorText):s[r].regionsSelectors.push(t.selectorText);break}}return s},doLayout:function(){if(!this.namedFlows||!this.namedFlows.length){console.warn("No named flow / regions CSS rules");return}console.log("CSS Regions doLayout()"),s()},exposeGlobalOM:function(){document.getNamedFlows=document.webkitGetNamedFlows=this.getNamedFlows.bind(this)},getNamedFlows:function(){return this.namedFlowCollection},addSourceToNamedFlow:function(e,t){var n=this.getNamedFlows().namedItem(e);n||(n=new g(e),this.namedFlows.push(n),this.namedFlowCollection=new m(this.namedFlows,"name")),n.contentNodes.push(t)},addRegionToNamedFlow:function(e,t){var n=this.getNamedFlows().namedItem(e);n||(n=new g(e),this.namedFlows.push(n),this.namedFlowCollection=new m(this.namedFlows,"name")),n.regions.push(t)},NamedFlow:g,Collection:m};var n=function(e){var t,n,r,i,s=[],o=e.length;for(t=0;t<o;t++){i=document.querySelectorAll(e[t]);for(n=0,r=i.length;n<r;++n)s.push(i[n])}return h(document.body,NodeFilter.SHOW_ELEMENT,{acceptNode:function(e){return s.indexOf(e)>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}})},r=function(e){var t,n,r,i=[];for(t=0,n=e.length;t<n;t++)r=e[t].cloneNode(!0),i.push(r),r.style.display==="none"&&(r.style.display=r["data-display"]||""),getComputedStyle(e[t]).display!=="none"&&(e[t]["data-display"]=e[t].style.display,e[t].style.display="none");return i},i=function(e){var t,n,r,i=[];for(t=0,n=e.length;t<n;t++)r=e[t],getComputedStyle(r).display!=="none"&&i.push(r);return i},s=function(){var e,t,n,s,u,a,l,c,h,p=document.getNamedFlows();for(n=0,s=p.length;n<s;n++){t=p[n],t.regionsByContent={content:[],regions:[]},t.firstEmptyRegionIndex=-1,l=r(t.contentNodes),c=i(t.getRegions()),t.overset=!1;for(u=0,a=c.length;u<a;u++){e=c[u],e.innerHTML="";if(l.length===0){t.firstEmptyRegionIndex===-1&&(t.firstEmptyRegionIndex=u),e.webKitRegionOverset="empty",e.regionOverset="empty";continue}if(getComputedStyle(e).display!=="none"){h=l.shift();if(u+1===a){while(h)e.appendChild(h.cloneNode(!0)),f(h,-1,e,t),h=l.shift();d(e)&&(e.webKitRegionOverset="overset",e.regionOverset="overset",t.overset=!0)}else{while(h){h=o(h,e,t);if(h){l.unshift(h);break}h=l.shift()}e.webKitRegionOverset="fit",e.regionOverset="fit"}}}t.regions.length>0&&(t.fire({type:"regionlayoutupdate",target:t}),t.fire({type:"webkitregionlayoutupdate",target:t}),console.log("Dispatch regionlayoutupdate event"))}},o=function(e,t,n){var r,i,s,o,a,v,m=null,g=[],y=[],b=e;t.appendChild(b);if(d(t)){t.removeChild(b),g=h(b,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:function(e){return e.nodeName.toLowerCase()==="img"||e.nodeName.toLowerCase()==="fig"||e.nodeName.toLowerCase()==="#text"&&e.data.replace(/^\s+|\s+$/g,"")!==""?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});if(g.length!==1||g[0].nodeName.toLowerCase()!=="img"&&g[0].nodeName.toLowerCase()!=="fig"){for(i=g.length-1;i>=0;i--){r=g[i],r.nodeName==="#text"?(y[i]=r.data,r.data=""):(y[i]=r.parentNode,r.parentNode.removeChild(r)),t.appendChild(b);if(!d(t)){v=i,t.removeChild(b);break}t.removeChild(b)}i<0?m=e:(r.nodeName==="#text"&&(a=y[v].replace(/^\s+|\s+$/g,""),o=a.split(" "),s=l(t,b,r,o),y[v]=p(o,s,o.length-1),s>0&&(i+=1)),t.appendChild(u(b.cloneNode(!0))),f(t.lastChild,t,n),c(v,g,y,b),m=b)}else m=e}else f(b,t,n);return m},u=function(e){var t,n,r;n=h(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:function(e){return e.nodeName.toLowerCase()==="img"||e.nodeName.toLowerCase()==="fig"||e.nodeName.toLowerCase()==="#text"&&e.data.replace(/^\s+|\s+$/g,"")!==""?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}}),r=n[n.length-1],t=r.nextSibling;while(t)a(t),t=t.nextSibling;t=r.parentNode.nextSibling;while(t)a(t),t=t.nextSibling;t=r.parentNode;while(t){if(t.parentNode===e){while(t.nextSibling)t.parentNode.removeChild(t.nextSibling);break}t=t.parentNode}return e},a=function(e){var t,n,r;if(e.nodeName==="#text"){e.parentNode.removeChild(e);return}t=e.childNodes;for(n=t.length-1;n>=0;n--)r=t.item(n),r.nodeName!=="#text"?r.childNodes.length===0?r.parentNode.removeChild(r):a(r):r.parentNode.removeChild(r);e.childNodes.length===0&&e.parentNode.removeChild(e)},f=function(e,t,n){var r,i,s,o,u,a;a=h(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:function(e){return e.nodeName.toLowerCase()==="img"||e.nodeName.toLowerCase()==="fig"||e.nodeName.toLowerCase()==="#text"&&e.data.replace(/^\s+|\s+$/g,"")!==""?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}}),n.regionsByContent||(n.regionsByContent={content:[],regions:[]});for(r=0,i=a.length;r<i;r++)o=a[r],o.nodeName.toLowerCase()==="#text"&&(o=o.parentNode),u=n.regionsByContent.content.indexOf(o),u===-1&&(n.regionsByContent.content.push(o),u=n.regionsByContent.content.length-1),s=n.regionsByContent.regions[u]||[],s.push(t),n.regionsByContent.regions[u]=s},l=function(e,t,n,r){var i=0,s=0,o=r.length-1;while(o>=s)i=s+Math.round((o-s)/2),n.data=p(r,0,i-1),e.appendChild(t),d(e)?(o=i-1,o<s&&(s=o)):s=i+1,e.removeChild(t);return i},c=function(e,t,n,r){var i,s,o,u,a=[];for(s=0;s<e;s++){i=t[s];if(i.nodeName==="#text"){u=i.parentNode,u.removeChild(i);while(u&&u.childNodes.length===0)u=u.parentNode,u.removeChild(u.childNodes.item(0));u&&a.push(u)}else a.push(i.parentNode),i.parentNode.removeChild(i)}for(s=0,o=a.length;s<o;s++){u=a[s];while(u&&u.childNodes.length===0)u=u.parentNode,u&&u.removeChild(u.childNodes.item(0))}u=t[e].parentNode;while(u){if(u.parentNode===r){while(u.previousSibling)u.parentNode.removeChild(u.previousSibling);break}u=u.parentNode}for(s=e,o=t.length;s<o;s++)i=t[s],i.nodeName==="#text"?i.data=n[s]:n[s].appendChild(i)},h=function(e,t,n){var r,i,s=[];r=document.createNodeIterator(e,t,n,!1);while(i=r.nextNode())s.push(i);return s},p=function(e,t,n){return e.slice(t,n+1).join(" ")+" "},d=function(e){var t,n=e.style.overflow;if(!n||n==="visible")e.style.overflow="hidden";return t=e.clientHeight<e.scrollHeight,e.style.overflow=n,t};v.prototype={constructor:v,addEventListener:function(e,t){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t),y.doLayout()},fire:function(e){var t,n,r;if(this._listeners[e.type]instanceof Array){t=this._listeners[e.type];for(n=0,r=t.length;n<r;n++)t[n].call(this,e)}},removeEventListener:function(e,t){var n,r,i;if(this._listeners[e]instanceof Array){n=this._listeners[e];for(r=0,i=n.length;r<i;r++)if(n[r]===t){n.splice(r,1);break}}}},m.prototype={item:function(e){return this[e]||null},namedItem:function(e){return this.map[e]||null}},g.prototype=new v,g.prototype.constructor=g,g.prototype.getRegions=function(){return this.regions},g.prototype.getRegionsByContent=function(e){var t,n=[];return t=this.regionsByContent.content.indexOf(e),t!==-1&&(n=this.regionsByContent.regions[t]),n};var y;if(!Modernizr)throw new Error("Modernizr is not loaded!");if(Modernizr.regions)return;return y=new t,typeof e.addEventListener!="undefined"?(e.addEventListener("load",function(){y.init()}),e.addEventListener("resize",function(){y.doLayout()})):(e.attachEvent("onload",function(){y.init()}),e.attachEvent("onresize",function(){y.doLayout()})),y}(window);